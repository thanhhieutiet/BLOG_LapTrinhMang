---
title: "Tá»› Ä‘Ã£ máº¥t tráº¯ng 10 tiáº¿ng khi lÃ m viá»‡c vá»›i malware nhÆ° tháº¿ nÃ o"
date: 2025-08-10
categories: ["security", "research"]
tags: ["malware", "debugging", "androguard", "research", "python"]
author: "Tiáº¿t Thanh Minh Hiáº¿u"
description: "Má»™t ngÃ y mÃ¬nh dÃ nh trá»n 10 tiáº¿ng chá»‰ Ä‘á»ƒ xá»­ lÃ½ lá»—i trÃ­ch xuáº¥t dá»¯ liá»‡u malware â€“ vÃ  bÃ i há»c lá»›n nháº¥t khÃ´ng náº±m trong code, mÃ  náº±m á»Ÿ cÃ¡ch tiáº¿p cáº­n váº¥n Ä‘á»."
image: "thumbnail.png"
showToc: true
keywords:
  [
    "malware analysis",
    "androguard",
    "python debugging",
    "ai security",
    "research",
  ]
---

Buá»•i sÃ¡ng hÃ´m Ä‘Ã³, mÃ¬nh khá»Ÿi Ä‘á»™ng pipeline vá»›i tÃ¢m tháº¿ tá»± tin: 13,205 file APK, Androguard script má»›i tá»‘i Æ°u, há»‡ thá»‘ng log sáº¡ch sáº½.

Má»i thá»© Ä‘á»u hoÃ n háº£oâ€¦ cho Ä‘áº¿n khi mÃ¬nh nhÃ¬n tháº¥y dÃ²ng cuá»‘i cÃ¹ng:

<div align="center">

![Lá»—i Ä‘áº§u tiÃªn â€“ toÃ n bá»™ 13,205 máº«u Ä‘á»u tháº¥t báº¡i](fail_api.png)

_HÃ¬nh: Láº§n cháº¡y Ä‘áº§u tiÃªn â€“ 13,205 máº«u tháº¥t báº¡i, 0% thÃ nh cÃ´ng sau 9 tiáº¿ng 41 phÃºt._

</div>

> âœ… Completed  
> âŒ Success: 0 (0.0%)  
> âŒ Errors: 13,205 (100.0%)  
> â± Total time: 9h41m

9 tiáº¿ng 41 phÃºt cháº¡y, vÃ  káº¿t quáº£: **toÃ n bá»™ 13,205 file Ä‘á»u lá»—i.**

ÄÃ³ lÃ  khoáº£nh kháº¯c mÃ¬nh hiá»ƒu tháº¿ nÃ o lÃ  â€œnghiÃªn cá»©u thá»±c táº¿â€.

---

## 1. Khi pipeline â€œÄ‘áº¹pâ€ trÃªn giáº¥y vÃ  sá»¥p Ä‘á»• ngoÃ i thá»±c táº¿

TrÆ°á»›c Ä‘Ã³, mÃ¬nh Ä‘Ã£ test pipeline vá»›i vÃ i chá»¥c máº«u â€” cháº¡y mÆ°á»£t.  
NhÆ°ng khi scale lÃªn hÃ ng chá»¥c GB dá»¯ liá»‡u, má»i thá»© báº¯t Ä‘áº§u gÃ£y.

Lá»—i hiá»ƒn thá»‹ Ä‘áº§u tiÃªn:

```

TypeError: object of type 'generator' has no len()

```

Thoáº¡t nhÃ¬n, tÆ°á»Ÿng lá»—i nhá». NhÆ°ng khi pipeline Ä‘a tiáº¿n trÃ¬nh Ä‘ang cháº¡y,  
má»™t lá»—i nhÆ° váº­y Ä‘á»§ khiáº¿n toÃ n bá»™ tiáº¿n trÃ¬nh **dá»«ng giá»¯a chá»«ng** mÃ  khÃ´ng ghi log nÃ o há»¯u Ã­ch.

---

## 2. CÃ¢u chuyá»‡n cá»§a â€œlen()â€ â€“ káº» thÃ¹ khÃ´ng ngá» tá»›i

HÃ³a ra, trong báº£n má»›i cá»§a **Androguard**, hÃ m `get_methods()`  
Ä‘Ã£ Ä‘Æ°á»£c thay Ä‘á»•i tá»« viá»‡c tráº£ vá» **list** sang **generator** â€“ Ä‘á»ƒ tiáº¿t kiá»‡m bá»™ nhá»›.

VÃ  generator thÃ¬â€¦ khÃ´ng cÃ³ Ä‘á»™ dÃ i.  
VÃ¬ váº­y:

```python
len(api_list)  # ğŸ’¥ TypeError
```

Chá»‰ má»™t dÃ²ng nhÆ° váº­y, khiáº¿n 13,205 file bá»‹ bá» qua, khÃ´ng trÃ­ch xuáº¥t Ä‘Æ°á»£c báº¥t ká»³ Ä‘áº·c trÆ°ng nÃ o.

---

## 3. Khi debug trá»Ÿ thÃ nh nghiÃªn cá»©u

Thay vÃ¬ thá»­ â€œfix nhanhâ€, mÃ¬nh dá»«ng láº¡i Ä‘á»c source code cá»§a Androguard.
Trong pháº§n changelog, mÃ¬nh tháº¥y dÃ²ng nhá»:

> â€œget_methods() now returns a generator for memory efficiency.â€

ÄÃ³ khÃ´ng pháº£i bug, mÃ  lÃ  **má»™t â€œfeatureâ€ gÃ¢y ra 10 tiáº¿ng tháº¥t báº¡i.**
Tá»« Ä‘Ã³, mÃ¬nh há»c Ä‘Æ°á»£c ráº±ng:

> Khi nghiÃªn cá»©u, khÃ´ng chá»‰ cáº§n â€œcháº¡y codeâ€, mÃ  pháº£i **hiá»ƒu cÃ¡ch nÃ³ cháº¡y.**

---

## 4. Logging â€“ tá»« chi tiáº¿t nhá» thÃ nh cÃ´ng cá»¥ sá»‘ng cÃ²n

Sau tháº¥t báº¡i Ä‘Ã³, mÃ¬nh viáº¿t láº¡i pipeline logging tá»«ng bÆ°á»›c:

```python
try:
    methods = list(dx.get_methods())
    feature_count = len(methods)
except Exception as e:
    logger.error(f"[{apk_name}] {type(e).__name__}: {e}")
```

Viá»‡c log chi tiáº¿t giÃºp mÃ¬nh phÃ¡t hiá»‡n thÃªm:

- Má»™t sá»‘ file APK bá»‹ giáº£i nÃ©n lá»—i.
- Má»™t sá»‘ bá»‹ timeout khi parse.
- Má»™t sá»‘ hoÃ n toÃ n khÃ´ng cÃ³ smali há»£p lá»‡.

Khi xem láº¡i log, mÃ¬nh nháº­n ra:
**Androguard khÃ´ng sai â€“ mÃ¬nh chá»‰ chÆ°a hiá»ƒu cÃ¡ch nÃ³ hoáº¡t Ä‘á»™ng Ä‘á»§ sÃ¢u.**

---

## 5. Thread-safety vÃ  bÃ i há»c vá» kiÃªn nháº«n

Má»™t báº¥t ngá» khÃ¡c: Androguard **khÃ´ng thread-safe**.
Cháº¡y Ä‘a tiáº¿n trÃ¬nh â†’ crash ngáº«u nhiÃªn, káº¿t quáº£ khÃ´ng á»•n Ä‘á»‹nh.

MÃ¬nh chuyá»ƒn pipeline vá» xá»­ lÃ½ tuáº§n tá»±, thÃªm kiá»ƒm tra tráº¡ng thÃ¡i tá»«ng file.
Káº¿t quáº£: pipeline hoÃ n chá»‰nh cháº¡y á»•n Ä‘á»‹nh vá»›i **94.7% máº«u thÃ nh cÃ´ng** â€“
sau khi **hi sinh 9 tiáº¿ng vÃ  13,205 lá»—i Ä‘áº§u tiÃªn**.

---

## 6. Sau táº¥t cáº£ â€“ Ä‘iá»u quan trá»ng khÃ´ng náº±m trong code

NhÃ¬n láº¡i, bÃ i há»c lá»›n nháº¥t khÃ´ng pháº£i lÃ  cÃº phÃ¡p Python hay cÃ¡ch fix bug,
mÃ  lÃ  **tÆ° duy xá»­ lÃ½ váº¥n Ä‘á» cÃ³ há»‡ thá»‘ng**:

| Giai Ä‘oáº¡n | TÆ° duy cÅ©             | TÆ° duy má»›i                            |
| --------- | --------------------- | ------------------------------------- |
| Gáº·p lá»—i   | â€œTáº¡i sao khÃ´ng cháº¡y?â€ | â€œNÃ³ Ä‘ang cháº¡y nhÆ° tháº¿ nÃ o?â€           |
| Debug     | â€œThá»­ fix nhanhâ€       | â€œTáº¡o mÃ´i trÆ°á»ng tÃ¡i hiá»‡n lá»—iâ€         |
| Log       | â€œIn ra vÃ i dÃ²ngâ€      | â€œGhi láº¡i tráº¡ng thÃ¡i tá»«ng bÆ°á»›câ€        |
| Káº¿t luáº­n  | â€œLá»—i á»Ÿ thÆ° viá»‡nâ€      | â€œMÃ¬nh chÆ°a hiá»ƒu rÃµ cÃ¡ch nÃ³ hoáº¡t Ä‘á»™ngâ€ |

---

## 7. Niá»m vui sau 10 tiáº¿ng debugging

Khoáº£nh kháº¯c terminal hiá»‡n dÃ²ng cuá»‘i cÃ¹ng:

```
âœ… Extracted features for 13,205 samples (12,511 successful)
```

KhÃ´ng chá»‰ lÃ  má»™t con sá»‘ â€” mÃ  lÃ  **káº¿t quáº£ cá»§a 10 tiáº¿ng hiá»ƒu, thá»­, vÃ  kiÃªn nháº«n.**
NghiÃªn cá»©u AI Security khÃ´ng hÃ o nhoÃ¡ng nhÆ° trÃªn giáº¥y,
nhÆ°ng chÃ­nh nhá»¯ng khoáº£nh kháº¯c nhÆ° tháº¿ nÃ y khiáº¿n mÃ¬nh cÃ ng yÃªu cÃ´ng viá»‡c hÆ¡n.

---

> â€œMalware khÃ´ng giáº¿t mÃ¬nh â€“ exception má»›i lÃ m Ä‘iá»u Ä‘Ã³.â€
> â€” Má»™t láº­p trÃ¬nh viÃªn tá»«ng debug 13,000 file trong má»™t ngÃ y.

---

_Keep learning, keep debugging._
